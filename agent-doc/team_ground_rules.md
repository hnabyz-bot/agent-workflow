# 실전 팀 운영 규칙

**⚠️ 전제**: Agent 간 직접 대화 불가능. 모든 협업은 사용자가 중개.

## 1) 공통 운영 원칙
- 모든 작업은 "어느 Phase, 어느 Activity를 수행 중인지"를 명시하고 시작
- 각 Activity에는 명시적인 Owner(담당 Agent)가 있어야 함
- Owner가 바뀔 때마다 **사용자가 Hand-off 메모(요약)를 작성하여 전달**

## 2) Agent 호출/사용 규칙
- **기본: 순차 활용** (한 Agent에게 끝까지 맡기기)
- **선택적 협업**: 막힐 때만 다른 Agent 호출
- 설계/아키텍처/성능·보안 판단 필요 시:
  1. Gemini 호출 (사용자가 요청)
  2. 결과를 Claude 문서에 반영 (사용자가 전달)
  3. Copilot 구현으로 넘김 (사용자가 전달)
- 대량 코드 수정/테스트/빌드/배포 ⇒ Copilot 기본 진입점
- 요구사항 정리, 계획, 문서 ⇒ Claude 기본 진입점

## 3) 실패 처리 규칙(Fail Policy)

### 3.1 실행/빌드/테스트 실패
- **Copilot이 1차 Owner**
  1. Copilot이 로그 수집 및 원인 분석
  2. 설계/요구사항 문제 시 **사용자가** Gemini/Claude로 escalate
- 설계적 모순·성능 한계 발견 시:
  - 현재 마일스톤에서 무리하게 우회 금지
  - 다음 마일스톤에 설계 수정 Task 우선순위 상향

### 3.2 Agent 출력 품질 실패 (Failure Recovery Protocol)

#### A. Agent 출력 검증 실패 시
**감지 기준:**
- 품질 게이트 체크리스트 50% 미만 통과
- 요청 사항과 출력물 불일치
- 명백한 논리 오류 또는 실행 불가능한 산출물

**복구 절차:**
1. `[ ]` 즉시 작업 중단, 해당 산출물 사용 금지
2. `[ ]` `project_status.md`에 실패 기록
   ```markdown
   ## Failure Log
   - **Time:** YYYY-MM-DD HH:MM
   - **Agent:** [Agent명]
   - **Failure Type:** Output Validation Failed
   - **Reason:** [구체적 사유]
   ```
3. `[ ]` 재시도 판단:
   - **동일 Agent 재시도:** 프롬프트가 불명확했거나 컨텍스트 누락된 경우
   - **다른 Agent 전환:** Agent의 역량 한계로 판단되는 경우
4. `[ ]` Git으로 작업 중이었다면 `git reset --hard [이전 커밋]`으로 롤백

#### B. 핸드오프 컨텍스트 손실 감지
**감지 기준:**
- Agent가 "이전 내용을 모르겠다" 또는 "컨텍스트가 부족하다" 응답
- 이전 결정사항을 무시한 산출물 생성

**복구 절차:**
1. `[ ]` 핸드오프 체크리스트 역검증:
   - `[ ]` `project_status.md` 최신 버전 첨부 여부
   - `[ ]` 이전 Agent 산출물 전체 복사 여부
   - `[ ]` 명확한 목표(Objective) 명시 여부
2. `[ ]` 누락 항목 보완 후 재요청
3. `[ ]` `project_status.md`에 "Context Loss 발생" 기록 후 재발 방지

#### C. 연쇄 실패 (Cascading Failure) 방지
**정의:** 3회 연속 Agent 출력 실패 또는 2회 연속 핸드오프 실패

**조치:**
1. `[ ]` 현재 마일스톤 작업 전면 중단
2. `[ ]` Gemini에게 "현재까지 진행 상황 + 실패 로그" 전달하여 근본 원인 분석 요청
3. `[ ]` 분석 결과 기반으로 계획 재수립 (Claude) 또는 요구사항 재정의
4. `[ ]` 재시작 전 팀 회고: "왜 3번 실패했는가?" 문서화

## 4) 테스트/품질 규칙

### 4.1 테스트 설계 및 구현
- **Gemini**: 마일스톤 시작 시 "테스트 전략(커버리지 목표, 성능/장애 시나리오) + 주요 테스트 케이스 의사코드" 통합 제공
- **Claude**: (선택 사항) Gemini의 의사코드를 BDD 스타일 명세로 표현 (복잡한 경우만)
- **Copilot**: 테스트 코드 구현 및 모든 테스트 통과를 Done 조건으로 삼음
- 마일스톤 Review 시 "실패/미작성 테스트 목록" 리뷰 후 다음 반영

**변경 사유:**
- 기존: Gemini(전략) → Claude(설계) → Copilot(구현) 3단 핸드오프
- 개선: Gemini(전략+설계) → Copilot(구현) 2단 핸드오프
- 효과: Agent 전환 1회 감소, Claude 부담 경감

## 5) 문서-코드 동기화 규칙 (개정)

### 5.1 조건부 동기화 전략
**기존 문제:** 매 마일스톤마다 Claude 호출 시 과도한 전환 오버헤드 발생

**개선 방안:**
- **마일스톤 종료 시 (매번):**
  - **Copilot**: `project_status.md`에 변경 요약 기록 (변경 파일 목록, 주요 기능 3줄)
  - Git commit message에 상세 정보 포함

- **Claude 호출 타이밍 (선택적):**
  - 2-3개 마일스톤 묶음 완료 시
  - Phase 종료 시 (필수)
  - 외부 공유용 문서 필요 시

**To Claude 요청 시:**
```
"첨부한 project_status.md와 지난 3개 마일스톤의 git log를 바탕으로,
설계 문서, 운영 가이드, API 명세를 일괄 갱신해줘."
```

**효과:**
- Claude 투입 횟수: 5-7회/Phase → 2-3회/Phase
- 전환 오버헤드: 25% → 20% 감소
- Git log로 충분한 추적성 확보

6) FPGA/도메인 특화 규칙(옵션)
HDL/FPGA 관련 변경 시에는 “인터페이스/타이밍/리소스 영향 분석”을 Gemini에게 먼저 요청하고, 그 결과를 Claude가 명세서에 기록한 뒤 Copilot이 테스트벤치/빌드 스크립트로 구현한다.
​

HW/SW 경계(예: 레지스터 맵, AXI 인터페이스) 변경은 항상 문서–테스트–코드가 동시에 갱신되도록, 하나의 Task 안에서 Claude–Copilot–Gemini 순서로 한 번에 처리한다.
​